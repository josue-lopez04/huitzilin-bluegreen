name: Deploy Blue-Green
on:
  push:
    branches: [ "main" ]

permissions:
  contents: read
  packages: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build & Push Docker images
        run: |
          docker build -t ghcr.io/josue-lopez04/huitzilin-backend:${{ github.sha }} ./backend
          docker build -t ghcr.io/josue-lopez04/huitzilin-frontend:${{ github.sha }} ./frontend
          echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          docker push ghcr.io/josue-lopez04/huitzilin-backend:${{ github.sha }}
          docker push ghcr.io/josue-lopez04/huitzilin-frontend:${{ github.sha }}



      - name:  Blue-Green switch
        run: |
          echo "üèóÔ∏è  despliegue Blue-Green local..."
          chmod +x scripts/*.sh
          bash scripts/detect_active.sh
          bash scripts/switch_to_green.sh
          echo "‚úÖ Switch completado."
